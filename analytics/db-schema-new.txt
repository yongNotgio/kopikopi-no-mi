-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.cluster_stage_data (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  cluster_id uuid NOT NULL,
  season character varying NOT NULL,
  date_planted date,
  plant_age_months integer,
  number_of_plants integer,
  fertilizer_type USER-DEFINED,
  fertilizer_frequency USER-DEFINED,
  pesticide_type USER-DEFINED,
  pesticide_frequency USER-DEFINED,
  last_pruned_date date,
  previous_pruned_date date,
  pruning_interval_months integer,
  shade_tree_present boolean,
  shade_tree_species character varying,
  soil_ph numeric,
  avg_temp_c numeric,
  avg_rainfall_mm numeric,
  avg_humidity_pct numeric,
  actual_flowering_date date,
  estimated_flowering_date date,
  estimated_harvest_date date,
  actual_harvest_date date,
  pre_last_harvest_date date,
  pre_total_trees integer,
  pre_yield_kg numeric,
  pre_grade_fine numeric,
  pre_grade_premium numeric,
  pre_grade_commercial numeric,
  previous_fine_pct numeric,
  previous_premium_pct numeric,
  previous_commercial_pct numeric,
  defect_count integer,
  bean_moisture numeric,
  bean_screen_size character varying,
  predicted_yield numeric,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT cluster_stage_data_pkey PRIMARY KEY (id),
  CONSTRAINT cluster_stage_data_cluster_id_fkey FOREIGN KEY (cluster_id) REFERENCES public.clusters(id)
);
CREATE TABLE public.clusters (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  farm_id uuid NOT NULL,
  cluster_name character varying NOT NULL,
  area_size_sqm numeric NOT NULL,
  plant_count integer NOT NULL,
  variety character varying,
  plant_stage USER-DEFINED NOT NULL DEFAULT 'seed-sapling'::plant_stage,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT clusters_pkey PRIMARY KEY (id),
  CONSTRAINT clusters_farm_id_fkey FOREIGN KEY (farm_id) REFERENCES public.farms(id)
);
CREATE TABLE public.farms (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  user_id uuid NOT NULL UNIQUE,
  farm_name character varying,
  farm_area numeric,
  elevation_m numeric,
  overall_tree_count integer,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT farms_pkey PRIMARY KEY (id),
  CONSTRAINT farms_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.harvest_records (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  cluster_id uuid NOT NULL,
  season character varying,
  actual_harvest_date date,
  yield_kg ARRAY,
  grade_fine ARRAY,
  grade_premium ARRAY,
  grade_commercial ARRAY,
  notes ARRAY,
  recorded_at timestamp with time zone NOT NULL DEFAULT now(),
  fine_pct ARRAY,
  premium_pct ARRAY,
  commercial_pct ARRAY,
  CONSTRAINT harvest_records_pkey PRIMARY KEY (id),
  CONSTRAINT harvest_records_cluster_id_fkey FOREIGN KEY (cluster_id) REFERENCES public.clusters(id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  username character varying NOT NULL UNIQUE,
  email character varying NOT NULL UNIQUE,
  password_hash character varying NOT NULL,
  first_name character varying NOT NULL,
  last_name character varying NOT NULL,
  middle_initial character varying,
  contact_number character varying NOT NULL,
  age integer NOT NULL CHECK (age >= 18 AND age <= 120),
  municipality character varying NOT NULL,
  province character varying NOT NULL,
  role character varying,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT users_pkey PRIMARY KEY (id)
);